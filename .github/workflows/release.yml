---
name: "Release"
on: # yamllint disable-line rule:truthy rule:comments
  release:
    types:
      - "published"

jobs:
  release:
    name: "Build and publish to PyPI"
    runs-on: "ubuntu-latest"
    environment:
      name: "pypi"
      url: "https://pypi.org/p/graphene-django-observability"
    permissions:
      id-token: "write"  # Required for PyPI Trusted Publishing (OIDC)
    steps:
      - name: "Check out repository code"
        uses: "actions/checkout@v4"
      - name: "Setup Python"
        uses: "actions/setup-python@v5"
        with:
          python-version: "3.12"
      - name: "Install Poetry"
        run: "pipx install poetry==2.1.3"
      - name: "Build package"
        run: "poetry build"
      - name: "Publish to PyPI"
        uses: "pypa/gh-action-pypi-publish@release/v1"
